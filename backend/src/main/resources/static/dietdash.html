<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diet Page - Vision Fit</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; display: flex; justify-content: space-between; padding: 20px; }
        .modal { width: 30%; padding: 20px; background: #f4f4f4; border-radius: 10px; }
        .input-group { margin-bottom: 15px; display: flex; justify-content: space-between; }
        .input-group label { flex: 1; }
        .input-group input, .input-group select { flex: 2; padding: 5px; }
        .search-container { width: 65%; }
        #search-bar { width: 100%; padding: 10px; font-size: 18px; }
        .food-result { margin-top: 20px; padding: 10px; background: #fff; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="modal">
        <h2>User Info</h2>
        <div class="input-group">
            <label for="username">Username:</label>
            <input type="text" id="username">
        </div>
        <div class="input-group">
            <label for="weight">Current Weight:</label>
            <input type="number" id="weight">
            <select id="metric">
                <option value="lb">lb</option>
                <option value="kg">kg</option>
            </select>
        </div>
        <div class="input-group">
            <label for="height">Height (feet):</label>
            <input type="number" id="height">
        </div>
    </div>

    <div class="search-container">
        <input type="text" id="search-bar" placeholder="Search for food..." onkeyup="searchFood(event)">
        <div id="results"></div>
    </div>

    <script>
        const consumerKey = "20d01056ddb348178df32763e5fe1874";
        const consumerSecret = "a2b014f52b0e443c86b506ec591aa8f7";

        function generateOAuthParams() {
            return {
                oauth_consumer_key: consumerKey,
                oauth_nonce: Math.random().toString(36).substring(2),
                oauth_signature_method: "HMAC-SHA1",
                oauth_timestamp: Math.floor(Date.now() / 1000),
                oauth_version: "1.0"
            };
        }

        function generateSignature(baseString, key) {
            return CryptoJS.HmacSHA1(baseString, key).toString(CryptoJS.enc.Base64);
        }

        async function searchFood(event) {
            if (event.key !== 'Enter') return;
            const query = document.getElementById("search-bar").value;
            const url = "https://platform.fatsecret.com/rest/server.api";
            
            const params = generateOAuthParams();
            params.method = "foods.search";
            params.search_expression = query;
            params.format = "json";
            
            const baseString = `POST&${encodeURIComponent(url)}&` + 
                encodeURIComponent(Object.keys(params).sort().map(k => `${k}=${params[k]}`).join("&"));
            
            params.oauth_signature = generateSignature(baseString, consumerSecret + "&");
            
            const formBody = new URLSearchParams(params).toString();
            const response = await fetch(url, {
                method: "POST",
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
                body: formBody
            });
            
            const data = await response.json();
            displayResults(data);
        }

        async function getFoodDetails(foodId) {
            const url = "https://platform.fatsecret.com/rest/food/v4";
            let params = generateOAuthParams();
            params.food_id = foodId;

            const baseString = `GET&${encodeURIComponent(url)}&` + 
                encodeURIComponent(Object.keys(params).sort().map(k => `${k}=${params[k]}`).join("&"));

            params.oauth_signature = generateSignature(baseString, consumerSecret + "&");

            const queryString = new URLSearchParams(params).toString();
            const response = await fetch(`${url}?${queryString}`, {
                method: "GET",
                headers: { "Content-Type": "application/x-www-form-urlencoded" }
            });

            const data = await response.json();
            console.log(data);
        }
        
        function displayResults(data) {
            const resultsDiv = document.getElementById("results");
            resultsDiv.innerHTML = "";
            const foods = data.foods.food;
            
            foods.forEach(food => {
                const div = document.createElement("div");
                div.classList.add("food-result");
                div.innerHTML = `<strong>${food.food_name}</strong><br>${food.food_description}`;
                div.onclick = () => getFoodDetails(food.food_id);
                resultsDiv.appendChild(div);
            });
        }
    </script>
</body>
</html>
